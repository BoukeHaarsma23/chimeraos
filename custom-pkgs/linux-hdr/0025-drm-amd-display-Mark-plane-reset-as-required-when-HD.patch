From 1b152646a59039e5fc748c5219a6733846f87b58 Mon Sep 17 00:00:00 2001
From: Joshua Ashton <joshua@froggi.es>
Date: Thu, 16 Mar 2023 17:01:05 +0000
Subject: [PATCH 25/25] drm/amd/display: Mark plane reset as required when
 HDR/TF state changes

Fixes HDR_MULT or TF sometimes not getting applied
---
 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 594f5f884fb8..11d9d60c3695 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -9213,6 +9213,12 @@ static bool should_reset_plane(struct drm_atomic_state *state,
 		    old_other_state->color_encoding != new_other_state->color_encoding)
 			return true;
 
+		/* HDR/Transfer Function changes. */
+		if (old_other_state->degamma_tf != new_other_state->degamma_tf ||
+			old_other_state->degamma_lut != new_other_state->degamma_lut ||
+			old_other_state->hdr_mult != new_other_state->hdr_mult)
+			return true;
+
 		/* Framebuffer checks fall at the end. */
 		if (!old_other_state->fb || !new_other_state->fb)
 			continue;
-- 
2.39.2

